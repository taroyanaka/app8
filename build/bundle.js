var app=function(){"use strict";function t(){}function e(t){return t()}function n(){return Object.create(null)}function a(t){t.forEach(e)}function o(t){return"function"==typeof t}function i(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function d(t,e){t.appendChild(e)}function c(t,e,n){t.insertBefore(e,n||null)}function l(t){t.parentNode&&t.parentNode.removeChild(t)}function r(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function s(t){return document.createElement(t)}function u(t){return document.createTextNode(t)}function f(){return u(" ")}function p(){return u("")}function _(t,e,n,a){return t.addEventListener(e,n,a),()=>t.removeEventListener(e,n,a)}function h(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function g(t,e){e=""+e,t.data!==e&&(t.data=e)}function m(t,e){t.value=null==e?"":e}let y;function v(t){y=t}function T(t){(function(){if(!y)throw new Error("Function called outside component initialization");return y})().$$.on_mount.push(t)}const $=[],b=[];let x=[];const w=[],D=Promise.resolve();let C=!1;function E(t){x.push(t)}const O=new Set;let j=0;function S(){if(0!==j)return;const t=y;do{try{for(;j<$.length;){const t=$[j];j++,v(t),k(t.$$)}}catch(t){throw $.length=0,j=0,t}for(v(null),$.length=0,j=0;b.length;)b.pop()();for(let t=0;t<x.length;t+=1){const e=x[t];O.has(e)||(O.add(e),e())}x.length=0}while($.length);for(;w.length;)w.pop()();C=!1,O.clear(),v(t)}function k(t){if(null!==t.fragment){t.update(),a(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(E)}}const N=new Set;function I(t,e){const n=t.$$;null!==n.fragment&&(!function(t){const e=[],n=[];x.forEach((a=>-1===t.indexOf(a)?e.push(a):n.push(a))),n.forEach((t=>t())),x=e}(n.after_update),a(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function A(t,e){-1===t.$$.dirty[0]&&($.push(t),C||(C=!0,D.then(S)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function V(i,d,c,r,s,u,f,p=[-1]){const _=y;v(i);const h=i.$$={fragment:null,ctx:[],props:u,update:t,not_equal:s,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(d.context||(_?_.$$.context:[])),callbacks:n(),dirty:p,skip_bound:!1,root:d.target||_.$$.root};f&&f(h.root);let g=!1;if(h.ctx=c?c(i,d.props||{},((t,e,...n)=>{const a=n.length?n[0]:e;return h.ctx&&s(h.ctx[t],h.ctx[t]=a)&&(!h.skip_bound&&h.bound[t]&&h.bound[t](a),g&&A(i,t)),e})):[],h.update(),g=!0,a(h.before_update),h.fragment=!!r&&r(h.ctx),d.target){if(d.hydrate){const t=function(t){return Array.from(t.childNodes)}(d.target);h.fragment&&h.fragment.l(t),t.forEach(l)}else h.fragment&&h.fragment.c();d.intro&&((m=i.$$.fragment)&&m.i&&(N.delete(m),m.i(T))),function(t,n,i,d){const{fragment:c,after_update:l}=t.$$;c&&c.m(n,i),d||E((()=>{const n=t.$$.on_mount.map(e).filter(o);t.$$.on_destroy?t.$$.on_destroy.push(...n):a(n),t.$$.on_mount=[]})),l.forEach(E)}(i,d.target,d.anchor,d.customElement),S()}var m,T;v(_)}class P{$destroy(){I(this,1),this.$destroy=t}$on(e,n){if(!o(n))return t;const a=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return a.push(n),()=>{const t=a.indexOf(n);-1!==t&&a.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}function J(t,e,n){const a=t.slice();return a[28]=e[n],a}function U(t,e,n){const a=t.slice();return a[31]=e[n],a}function z(t,e,n){const a=t.slice();return a[31]=e[n],a}function L(t,e,n){const a=t.slice();return a[31]=e[n],a}function W(t,e,n){const a=t.slice();return a[31]=e[n],a}function q(t){let e,n,a,o,i,r,f,p,_,m=t[31].id+"",y=t[31].desc_id+"",v=t[31].name+"";return{c(){e=u("id: "),n=u(m),a=u("\n\tdesc_id: "),o=u(y),i=u("\n\ttag.name: "),r=s("input"),p=s("p"),_=u(v),h(r,"type","text"),r.value=f=t[31].name},m(t,l){c(t,e,l),c(t,n,l),c(t,a,l),c(t,o,l),c(t,i,l),c(t,r,l),c(t,p,l),d(p,_)},p(t,e){256&e[0]&&m!==(m=t[31].id+"")&&g(n,m),256&e[0]&&y!==(y=t[31].desc_id+"")&&g(o,y),256&e[0]&&f!==(f=t[31].name)&&r.value!==f&&(r.value=f),256&e[0]&&v!==(v=t[31].name+"")&&g(_,v)},d(t){t&&l(e),t&&l(n),t&&l(a),t&&l(o),t&&l(i),t&&l(r),t&&l(p)}}}function B(t){let e,n;return{c(){e=s("option"),e.__value=n=t[31].name,e.value=e.__value},m(t,n){c(t,e,n)},p(t,a){2&a[0]&&n!==(n=t[31].name)&&(e.__value=n,e.value=e.__value)},d(t){t&&l(e)}}}function F(t){let e,n=t[9].allTags,a=[];for(let e=0;e<n.length;e+=1)a[e]=G(z(t,n,e));return{c(){for(let t=0;t<a.length;t+=1)a[t].c();e=p()},m(t,n){for(let e=0;e<a.length;e+=1)a[e]&&a[e].m(t,n);c(t,e,n)},p(t,o){if(512&o[0]){let i;for(n=t[9].allTags,i=0;i<n.length;i+=1){const d=z(t,n,i);a[i]?a[i].p(d,o):(a[i]=G(d),a[i].c(),a[i].m(e.parentNode,e))}for(;i<a.length;i+=1)a[i].d(1);a.length=n.length}},d(t){r(a,t),t&&l(e)}}}function G(t){let e,n,a,o,i,r,p,_,h,m=t[31].id+"",y=t[31].name+"";return{c(){e=s("div"),n=s("p"),a=u("id: "),o=u(m),i=f(),r=s("p"),p=u("tag.name: "),_=u(y),h=f()},m(t,l){c(t,e,l),d(e,n),d(n,a),d(n,o),d(e,i),d(e,r),d(r,p),d(r,_),d(e,h)},p(t,e){512&e[0]&&m!==(m=t[31].id+"")&&g(o,m),512&e[0]&&y!==(y=t[31].name+"")&&g(_,y)},d(t){t&&l(e)}}}function M(t){let e,n=t[9].allDescs,a=[];for(let e=0;e<n.length;e+=1)a[e]=H(J(t,n,e));return{c(){for(let t=0;t<a.length;t+=1)a[t].c();e=p()},m(t,n){for(let e=0;e<a.length;e+=1)a[e]&&a[e].m(t,n);c(t,e,n)},p(t,o){if(100864&o[0]){let i;for(n=t[9].allDescs,i=0;i<n.length;i+=1){const d=J(t,n,i);a[i]?a[i].p(d,o):(a[i]=H(d),a[i].c(),a[i].m(e.parentNode,e))}for(;i<a.length;i+=1)a[i].d(1);a.length=n.length}},d(t){r(a,t),t&&l(e)}}}function Z(t){let e,n,a,o,i,r,p,m,y,v,T,$,b,x,w,D,C=t[31].id+"",E=t[31].desc_id+"",O=t[31].name+"";function j(){return t[21](t[31])}return{c(){e=s("div"),n=s("p"),a=u("id: "),o=u(C),i=f(),r=s("p"),p=u("desc_id: "),m=u(E),y=f(),v=s("p"),T=u("tag.name: "),$=u(O),b=f(),x=s("button"),x.textContent="delete_desc_tag",h(e,"class","desc_tag svelte-ye7ijv")},m(t,l){c(t,e,l),d(e,n),d(n,a),d(n,o),d(e,i),d(e,r),d(r,p),d(r,m),d(e,y),d(e,v),d(v,T),d(v,$),d(e,b),d(e,x),w||(D=_(x,"click",j),w=!0)},p(e,n){t=e,512&n[0]&&C!==(C=t[31].id+"")&&g(o,C),512&n[0]&&E!==(E=t[31].desc_id+"")&&g(m,E),512&n[0]&&O!==(O=t[31].name+"")&&g($,O)},d(t){t&&l(e),w=!1,D()}}}function H(t){let e,n,o,i,p,h,m,y,v,T,$,b,x,w,D,C,E,O,j,S,k,N,I,A,V,P,J=t[28].id+"",z=t[28].auth_uid+"",L=t[28].title+"",W=t[28].description+"";function q(){return t[19](t[28])}function B(){return t[20](t[28])}let F=t[28].tags,G=[];for(let e=0;e<F.length;e+=1)G[e]=Z(U(t,F,e));return{c(){e=s("div"),n=s("p"),o=u("id: "),i=u(J),p=f(),h=s("button"),h.textContent="set_desc_data",m=f(),y=s("button"),y.textContent="delete_desc",v=f(),T=s("p"),$=u("auth_uid: "),b=u(z),x=f(),w=s("p"),D=u("title: "),C=u(L),E=f(),O=s("p"),j=u("description: "),S=u(W),k=f(),N=s("div"),N.textContent="tags:",I=f();for(let t=0;t<G.length;t+=1)G[t].c();A=f()},m(t,a){c(t,e,a),d(e,n),d(n,o),d(n,i),d(e,p),d(e,h),d(e,m),d(e,y),d(e,v),d(e,T),d(T,$),d(T,b),d(e,x),d(e,w),d(w,D),d(w,C),d(e,E),d(e,O),d(O,j),d(O,S),d(e,k),d(e,N),d(e,I);for(let t=0;t<G.length;t+=1)G[t]&&G[t].m(e,null);d(e,A),V||(P=[_(h,"click",q),_(y,"click",B)],V=!0)},p(n,a){if(t=n,512&a[0]&&J!==(J=t[28].id+"")&&g(i,J),512&a[0]&&z!==(z=t[28].auth_uid+"")&&g(b,z),512&a[0]&&L!==(L=t[28].title+"")&&g(C,L),512&a[0]&&W!==(W=t[28].description+"")&&g(S,W),66048&a[0]){let n;for(F=t[28].tags,n=0;n<F.length;n+=1){const o=U(t,F,n);G[n]?G[n].p(o,a):(G[n]=Z(o),G[n].c(),G[n].m(e,A))}for(;n<G.length;n+=1)G[n].d(1);G.length=F.length}},d(t){t&&l(e),r(G,t),V=!1,a(P)}}}function K(e){let n,o,i,p,y,v,T,$,b,x,w,D,C,E,O,j,S,k,N,I,A,V,P,J,U,z,G,Z,H,K,R,tt,et,nt,at,ot,it,dt,ct,lt,rt,st,ut,ft,pt,_t,ht,gt,mt,yt,vt,Tt,$t,bt,xt,wt,Dt=e[8],Ct=[];for(let t=0;t<Dt.length;t+=1)Ct[t]=q(W(e,Dt,t));let Et=e[1],Ot=[];for(let t=0;t<Et.length;t+=1)Ot[t]=B(L(e,Et,t));let jt=e[9].allTags&&F(e),St=e[9].allDescs&&M(e);return{c(){n=s("div"),o=s("button"),o.textContent="init_and_sample_insert",i=f(),p=s("button"),p.textContent="init_db",y=f(),v=s("button"),v.textContent="get_all_descs_and_tags",T=f(),$=s("button"),$.textContent="update_desc",b=u("\n\nauth_user_id: "),x=s("p"),x.textContent=`${Q}`,w=u("\n\nauth_uid: "),D=s("p"),C=u(e[2]),E=u("\nid: "),O=s("input"),j=s("p"),S=u(e[3]),k=u("\ncreated_at: "),N=s("input"),A=s("p"),V=u(e[4]),P=u("\nupdated_at: "),J=s("input"),z=s("p"),G=u(e[5]),Z=u("\ntitle: "),H=s("input"),K=s("p"),R=u(e[6]),tt=u("\ndescription: "),et=s("input"),nt=s("p"),at=u(e[7]),ot=f(),it=s("div"),it.textContent="tags:",dt=f();for(let t=0;t<Ct.length;t+=1)Ct[t].c();ct=u("\n\n\t\t\n\t\ttagをdescに追加\n\t\t"),lt=s("label"),lt.textContent="all_tags",rt=f(),st=s("input"),ut=f(),ft=s("datalist");for(let t=0;t<Ot.length;t+=1)Ot[t].c();pt=f(),_t=s("button"),_t.textContent="add_tag_to_desc",ht=f(),gt=s("div"),mt=s("h1"),mt.textContent="Web Data Tags",yt=f(),jt&&jt.c(),vt=f(),Tt=s("div"),$t=s("h1"),$t.textContent="Web Data Descs",bt=f(),St&&St.c(),h(O,"type","text"),O.value=e[3],h(N,"type","datetime-local"),N.value=I=Y(e[4]),h(J,"type","datetime-local"),J.value=U=Y(e[5]),h(H,"type","text"),H.value=e[6],h(et,"type","text"),et.value=e[7],h(lt,"for","my_all_tags"),h(st,"list","all_tags"),h(st,"id","my_all_tags"),h(st,"name","my_all_tags"),h(ft,"id","all_tags")},m(t,a){c(t,n,a),d(n,o),d(n,i),d(n,p),d(n,y),d(n,v),d(n,T),d(n,$),d(n,b),d(n,x),d(n,w),d(n,D),d(D,C),d(n,E),d(n,O),d(n,j),d(j,S),d(n,k),d(n,N),d(n,A),d(A,V),d(n,P),d(n,J),d(n,z),d(z,G),d(n,Z),d(n,H),d(n,K),d(K,R),d(n,tt),d(n,et),d(n,nt),d(nt,at),d(n,ot),d(n,it),d(n,dt);for(let t=0;t<Ct.length;t+=1)Ct[t]&&Ct[t].m(n,null);d(n,ct),d(n,lt),d(n,rt),d(n,st),m(st,e[0]),d(n,ut),d(n,ft);for(let t=0;t<Ot.length;t+=1)Ot[t]&&Ot[t].m(ft,null);d(n,pt),d(n,_t),c(t,ht,a),c(t,gt,a),d(gt,mt),d(gt,yt),jt&&jt.m(gt,null),c(t,vt,a),c(t,Tt,a),d(Tt,$t),d(Tt,bt),St&&St.m(Tt,null),xt||(wt=[_(o,"click",e[12]),_(p,"click",X),_(v,"click",e[13]),_($,"click",e[14]),_(st,"input",e[17]),_(_t,"click",e[18])],xt=!0)},p(t,e){if(4&e[0]&&g(C,t[2]),8&e[0]&&O.value!==t[3]&&(O.value=t[3]),8&e[0]&&g(S,t[3]),16&e[0]&&I!==(I=Y(t[4]))&&(N.value=I),16&e[0]&&g(V,t[4]),32&e[0]&&U!==(U=Y(t[5]))&&(J.value=U),32&e[0]&&g(G,t[5]),64&e[0]&&H.value!==t[6]&&(H.value=t[6]),64&e[0]&&g(R,t[6]),128&e[0]&&et.value!==t[7]&&(et.value=t[7]),128&e[0]&&g(at,t[7]),256&e[0]){let a;for(Dt=t[8],a=0;a<Dt.length;a+=1){const o=W(t,Dt,a);Ct[a]?Ct[a].p(o,e):(Ct[a]=q(o),Ct[a].c(),Ct[a].m(n,ct))}for(;a<Ct.length;a+=1)Ct[a].d(1);Ct.length=Dt.length}if(1&e[0]&&st.value!==t[0]&&m(st,t[0]),2&e[0]){let n;for(Et=t[1],n=0;n<Et.length;n+=1){const a=L(t,Et,n);Ot[n]?Ot[n].p(a,e):(Ot[n]=B(a),Ot[n].c(),Ot[n].m(ft,null))}for(;n<Ot.length;n+=1)Ot[n].d(1);Ot.length=Et.length}t[9].allTags?jt?jt.p(t,e):(jt=F(t),jt.c(),jt.m(gt,null)):jt&&(jt.d(1),jt=null),t[9].allDescs?St?St.p(t,e):(St=M(t),St.c(),St.m(Tt,null)):St&&(St.d(1),St=null)},i:t,o:t,d(t){t&&l(n),r(Ct,t),r(Ot,t),t&&l(ht),t&&l(gt),jt&&jt.d(),t&&l(vt),t&&l(Tt),St&&St.d(),xt=!1,a(wt)}}}let Q=1,R="http://localhost:8000";async function X(){try{const t=await fetch(R+"/init_db",{method:"POST",headers:{"Content-Type":"application/json"}}),e=await t.json();console.log(e)}catch(t){console.error("Error:",t)}}function Y(t){return t.slice(0,16)}function tt(t,e,n){let a="";function o(t,e){try{const a=d.find((t=>t.name===e));if(a){a.desc_id=t;const e=p.some((t=>t.id==t.id));e||n(8,p=[...p,a])}else{const a={id:d.length+1,name:e,desc_id:t,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()};n(1,d=[...d,a]),n(8,p=[...p,a])}}catch(t){console.error("Error:",t)}}function i(t){try{const e=x.allDescs.find((e=>e.id===t));console.log(e.tags),e?(n(2,c=e.auth_uid),n(3,l=e.id),n(4,r=e.created_at),n(5,s=e.updated_at),n(6,u=e.title),n(7,f=e.description),n(8,p=e.tags)):console.error(`No description found with id: ${t}`)}catch(t){console.error("Error:",t)}}let d=[],c="user1",l=1,r="2024-09-01T00:00:00",s="2024-09-01T00:00:00",u="foo",f="bar",p=[{desc_id:1,id:1,name:"tag1",created_at:"2024-09-01T00:00:00",updated_at:"2024-09-01T00:00:00"},{desc_id:1,id:2,name:"tag2",created_at:"2024-09-01T00:00:00",updated_at:"2024-09-01T00:00:00"},{desc_id:1,id:3,name:"tag3",created_at:"2024-09-01T00:00:00",updated_at:"2024-09-01T00:00:00"}];const _=[{auth_uid:"user1",desc_id:1,created_at:"2024-09-01T00:00:00",updated_at:"2024-09-01T00:00:00",title:"foo1",description:"bar1",tags:[{desc_id:1,id:1,name:"tag1",created_at:"2024-09-01T00:00:00",updated_at:"2024-09-01T00:00:00"},{desc_id:1,id:2,name:"tag2",created_at:"2024-09-01T00:00:00",updated_at:"2024-09-01T00:00:00"},{desc_id:1,id:3,name:"tag3",created_at:"2024-09-01T00:00:00",updated_at:"2024-09-01T00:00:00"}]},{auth_uid:"user1",desc_id:2,created_at:"2024-09-01T00:00:00",updated_at:"2024-09-01T00:00:00",title:"foo2",description:"bar2",tags:[{desc_id:2,id:1,name:"tag1",created_at:"2024-09-01T00:00:00",updated_at:"2024-09-01T00:00:00"},{desc_id:2,id:2,name:"tag2",created_at:"2024-09-01T00:00:00",updated_at:"2024-09-01T00:00:00"}]},{auth_uid:"user2",desc_id:3,created_at:"2024-09-01T00:00:00",updated_at:"2024-09-01T00:00:00",title:"foo3",description:"bar3",tags:[{desc_id:3,id:2,name:"tag2",created_at:"2024-09-01T00:00:00",updated_at:"2024-09-01T00:00:00"},{desc_id:3,id:3,name:"tag3",created_at:"2024-09-01T00:00:00",updated_at:"2024-09-01T00:00:00"}]}];const h={validateAuthUid:t=>/^[a-zA-Z0-9_-]+$/.test(t),validateDescId:t=>Number.isInteger(t)&&t>0,validateISODate:t=>/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}$/.test(t),validateTitle:t=>"string"==typeof t&&t.length>=1&&t.length<=100,validateDescription:t=>"string"==typeof t&&t.length>=1&&t.length<=1e3,validateTagName:t=>"string"==typeof t&&t.length>=1&&t.length<=10,validateData(t){const{auth_uid:e,desc_id:n,created_at:a,updated_at:o,title:i,description:d,tags:c}=t;return{isAuthUidValid:this.validateAuthUid(e),isDescIdValid:this.validateDescId(n),isTitleValid:this.validateTitle(i),isDescriptionValid:this.validateDescription(d),areTagsValid:c.every((t=>this.validateTagName(t.name)))}}};function g(){const t={auth_uid:c,desc_id:l,created_at:r,updated_at:s,title:u,description:f,tags:p};b=[];for(const[e,n]of Object.entries(h.validateData(t)))if(n||b.push(e),"tags"===e)for(const[t,e]of n.entries())for(const[n,a]of Object.entries(h.validateData(e)))a||b.push(`tags[${t}].${n}`);else"auth_uid"===e&&h.validateAuthUid(c),"desc_id"===e&&h.validateDescId(l),"created_at"===e&&h.validateISODate(r),"updated_at"===e&&h.validateISODate(s),"title"===e&&h.validateTitle(u),"description"===e&&h.validateDescription(f);return!(b.length>0)||(console.log(b),!1)}async function m(){try{if(!g())throw new Error("Validation failed");const t=await fetch("http://localhost:8000/insert_desc",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({auth_uid:c,created_at:r,updated_at:s,title:u,description:f,tags:p})}),e=await t.json();console.log(e)}catch(t){}}async function y(){try{const t=await fetch(R+"/",{method:"GET",headers:{"Content-Type":"application/json"}}),e=await t.json();n(9,x=e),n(1,d=e.allTags),console.log(e)}catch(t){console.error("Error:",t)}}async function v(t){try{const e=await fetch(R+"/delete_desc",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:t,auth_uid:c})}),n=await e.json();console.log(n)}catch(t){console.error("Error:",t)}}async function $(t,e){try{console.log(t,e,c);const n=await fetch(R+"/delete_desc_tag",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:t,desc_id:e,auth_uid:c})}),a=await n.json();console.log(a)}catch(t){console.error("Error:",t)}}let b=[],x=[];T((async()=>{await y()}));return(async()=>{})(),[a,d,c,l,r,s,u,f,p,x,o,i,async function(){try{for(const t of _)n(2,c=t.auth_uid),n(3,l=t.desc_id),n(4,r=t.created_at),n(5,s=t.updated_at),n(6,u=t.title),n(7,f=t.description),n(8,p=t.tags),await m()}catch(t){console.error("Error:",t)}},y,async function(){try{if(console.log("fetch_update_desc"),console.log(c,l,r,s,u,f,p),!g())throw new Error("Validation failed");const t=await fetch(R+"/update_desc",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({auth_uid:c,desc_id:l,title:u,description:f,tags:p})}),e=await t.json();console.log(e)}catch(t){console.error("Error:",t)}},v,$,function(){a=this.value,n(0,a)},()=>o(l,a),t=>i(t.id),t=>v(t.id),t=>$(t.id,t.desc_id)]}return new class extends P{constructor(t){super(),V(this,t,tt,K,i,{},null,[-1,-1])}}({target:document.body})}();
//# sourceMappingURL=bundle.js.map
